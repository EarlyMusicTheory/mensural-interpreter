<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>interpreterMain.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MEIdoc.html">MEIdoc</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MEIdoc.html#addAnnotation">addAnnotation</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#addMeiElement">addMeiElement</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#addRevision">addRevision</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#appendToIdDictionary">appendToIdDictionary</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#doXPathOnDoc">doXPathOnDoc</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#getAnnotation">getAnnotation</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#getBlockByEventId">getBlockByEventId</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#getBlocksFromSections">getBlocksFromSections</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#initAnnotations">initAnnotations</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#initEventDict">initEventDict</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#preprocess">preprocess</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#proportionMultiplier">proportionMultiplier</a></li><li data-type='method' style='display: none;'><a href="MEIdoc.html#renewBlob">renewBlob</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="alterate.html">alterate</a><ul class='methods'><li data-type='method' style='display: none;'><a href="alterate.html#.firstBeatAlteration">firstBeatAlteration</a></li><li data-type='method' style='display: none;'><a href="alterate.html#.midBeatAlteration">midBeatAlteration</a></li><li data-type='method' style='display: none;'><a href="alterate.html#.secondBeatAlteration">secondBeatAlteration</a></li><li data-type='method' style='display: none;'><a href="alterate.html#.thirdBeatAlteration">thirdBeatAlteration</a></li><li data-type='method' style='display: none;'><a href="alterate.html#~checkForGeneralAlteration">checkForGeneralAlteration</a></li></ul></li><li><a href="basic.html">basic</a><ul class='methods'><li data-type='method' style='display: none;'><a href="basic.html#.beatIndependentDurations">beatIndependentDurations</a></li><li data-type='method' style='display: none;'><a href="basic.html#~actOnColoration">actOnColoration</a></li><li data-type='method' style='display: none;'><a href="basic.html#~actOnDots">actOnDots</a></li><li data-type='method' style='display: none;'><a href="basic.html#~allUnalterableImperfectLevels">allUnalterableImperfectLevels</a></li><li data-type='method' style='display: none;'><a href="basic.html#~anteSim">anteSim</a></li><li data-type='method' style='display: none;'><a href="basic.html#~labelRests">labelRests</a></li><li data-type='method' style='display: none;'><a href="basic.html#~simplestAlterations">simplestAlterations</a></li></ul></li><li><a href="complexBeats.html">complexBeats</a><ul class='methods'><li data-type='method' style='display: none;'><a href="complexBeats.html#.complexAnalysis">complexAnalysis</a></li><li data-type='method' style='display: none;'><a href="complexBeats.html#~afterTheEasyBits">afterTheEasyBits</a></li></ul></li><li><a href="durIO.html">durIO</a><ul class='methods'><li data-type='method' style='display: none;'><a href="durIO.html#.readBlockFrom">readBlockFrom</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.readDur">readDur</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.readDurGes">readDurGes</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.readStartsAt">readStartsAt</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.setBeatPos">setBeatPos</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.setBreveBoundaries">setBreveBoundaries</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.setDurGesPerBlock">setDurGesPerBlock</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.setStartsAt">setStartsAt</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.windowDuration">windowDuration</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeAlteration">writeAlteration</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeComment">writeComment</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeDur">writeDur</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeDurGes">writeDurGes</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeDurWithRule">writeDurWithRule</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeImperfection">writeImperfection</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writePerfection">writePerfection</a></li><li data-type='method' style='display: none;'><a href="durIO.html#.writeSimpleImperfection">writeSimpleImperfection</a></li><li data-type='method' style='display: none;'><a href="durIO.html#~breveDifference">breveDifference</a></li><li data-type='method' style='display: none;'><a href="durIO.html#~gcd">gcd</a></li></ul></li><li><a href="imperfect.html">imperfect</a><ul class='methods'><li data-type='method' style='display: none;'><a href="imperfect.html#.firstBeatImperfection">firstBeatImperfection</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#.midBeatImperfection">midBeatImperfection</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#.secondBeatImperfection">secondBeatImperfection</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#.thirdBeatImperfection">thirdBeatImperfection</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~canImperfect">canImperfect</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~divisionLikeRests">divisionLikeRests</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~firstBeatImperfectionCheck">firstBeatImperfectionCheck</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~imperfectingLevels">imperfectingLevels</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~indexOfNextDot">indexOfNextDot</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~indexOfNextSameOrLongerOrDot">indexOfNextSameOrLongerOrDot</a></li><li data-type='method' style='display: none;'><a href="imperfect.html#~solidBlock">solidBlock</a></li></ul></li><li><a href="ioHandler.html">ioHandler</a></li><li></li><li><a href="post.html">post</a><ul class='methods'><li data-type='method' style='display: none;'><a href="post.html#.run">run</a></li><li data-type='method' style='display: none;'><a href="post.html#~addAppInfo">addAppInfo</a></li><li data-type='method' style='display: none;'><a href="post.html#~addBarLines">addBarLines</a></li></ul></li><li><a href="rm.html">rm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="rm.html#.augDot">augDot</a></li><li data-type='method' style='display: none;'><a href="rm.html#.beatUnitStructure">beatUnitStructure</a></li><li data-type='method' style='display: none;'><a href="rm.html#.divisionDot">divisionDot</a></li><li data-type='method' style='display: none;'><a href="rm.html#.dupleMinimCountFromElement">dupleMinimCountFromElement</a></li><li data-type='method' style='display: none;'><a href="rm.html#.firstPerfectLevel">firstPerfectLevel</a></li><li data-type='method' style='display: none;'><a href="rm.html#.isAlterable">isAlterable</a></li><li data-type='method' style='display: none;'><a href="rm.html#.isColored">isColored</a></li><li data-type='method' style='display: none;'><a href="rm.html#.isNote">isNote</a></li><li data-type='method' style='display: none;'><a href="rm.html#.leveleq">leveleq</a></li><li data-type='method' style='display: none;'><a href="rm.html#.mensurSummary">mensurSummary</a></li><li data-type='method' style='display: none;'><a href="rm.html#.minimStructures">minimStructures</a></li><li data-type='method' style='display: none;'><a href="rm.html#.noteInt">noteInt</a></li><li data-type='method' style='display: none;'><a href="rm.html#.noteOrRest">noteOrRest</a></li><li data-type='method' style='display: none;'><a href="rm.html#.notePerfectAsWhole">notePerfectAsWhole</a></li><li data-type='method' style='display: none;'><a href="rm.html#.regularlyPerfect">regularlyPerfect</a></li><li data-type='method' style='display: none;'><a href="rm.html#.simpleMinims">simpleMinims</a></li><li data-type='method' style='display: none;'><a href="rm.html#~noteIntFromDur">noteIntFromDur</a></li></ul></li><li><a href="startTimes.html">startTimes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="startTimes.html#.addAllStartTimes">addAllStartTimes</a></li><li data-type='method' style='display: none;'><a href="startTimes.html#.addBreveBoundariesForBlock">addBreveBoundariesForBlock</a></li><li data-type='method' style='display: none;'><a href="startTimes.html#.addStartTimes">addStartTimes</a></li><li data-type='method' style='display: none;'><a href="startTimes.html#.addStartTimesForBlock">addStartTimesForBlock</a></li><li data-type='method' style='display: none;'><a href="startTimes.html#.updateBlocks">updateBlocks</a></li></ul></li><li><a href="vrvInterface.html">vrvInterface</a><ul class='methods'><li data-type='method' style='display: none;'><a href="vrvInterface.html#.applyZoom">applyZoom</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#.loadData">loadData</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#.nextPage">nextPage</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#.prevPage">prevPage</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#.zoomIn">zoomIn</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#.zoomOut">zoomOut</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#~bindInteractionEvents">bindInteractionEvents</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#~deselectEvent">deselectEvent</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#~loadPage">loadPage</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#~selectEvent">selectEvent</a></li><li data-type='method' style='display: none;'><a href="vrvInterface.html#~setOptions">setOptions</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#baseUrl">baseUrl</a></li><li><a href="global.html#basicAnalysisDone">basicAnalysisDone</a></li><li><a href="global.html#checkIfAlreadyRun">checkIfAlreadyRun</a></li><li><a href="global.html#complexAnalysisDone">complexAnalysisDone</a></li><li><a href="global.html#currentParams">currentParams</a></li><li><a href="global.html#currentUrl">currentUrl</a></li><li><a href="global.html#evaluateResults">evaluateResults</a></li><li><a href="global.html#fetchMEI">fetchMEI</a></li><li><a href="global.html#getProperty">getProperty</a></li><li><a href="global.html#getPropertyByID">getPropertyByID</a></li><li><a href="global.html#getSectionBlocks">getSectionBlocks</a></li><li><a href="global.html#hideDetails">hideDetails</a></li><li><a href="global.html#instructor">instructor</a></li><li><a href="global.html#interpreter">interpreter</a></li><li><a href="global.html#intResp">intResp</a></li><li><a href="global.html#isRest">isRest</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#makeXmlCode">makeXmlCode</a></li><li><a href="global.html#meiFile">meiFile</a></li><li><a href="global.html#nextEvent">nextEvent</a></li><li><a href="global.html#prevEvent">prevEvent</a></li><li><a href="global.html#setProperty">setProperty</a></li><li><a href="global.html#setPropertyByID">setPropertyByID</a></li><li><a href="global.html#showDetails">showDetails</a></li><li><a href="global.html#shownEvent">shownEvent</a></li><li><a href="global.html#submitFeedback">submitFeedback</a></li><li><a href="global.html#updateBlob">updateBlob</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">interpreterMain.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

/** @var {URL} currentUrl current url */
var currentUrl = new URL(window.location.href);
/** @var baseUrl current base url */
var baseUrl = currentUrl.origin + currentUrl.pathname;
/** @var currentParams parameters of current url */
var currentParams = currentUrl.searchParams;
//var meiUrl;
/** @var {MEIdoc} meiFile contains the current used MEI document */
var meiFile = new MEIdoc();
/** @var {Boolean} basicAnalysisDone if basic analysis is done */
var basicAnalysisDone = false;
/** @var {Boolean} complexAnalysisDone if complex analysis is done */
var complexAnalysisDone = false;
/** @var {Boolean} instructor instructor mode */
var instructor = false;
/** @const {String} interpreter interpreter resp value */
const interpreter = "mensural-interpreter";
/** @const {String} intResp interpreter resp value */
const intResp = "#" + interpreter;

/** event that is currently shown in detail */
var shownEvent = null;
/** event preceding the currently shown event */
var prevEvent = null;
/** event that follows the currently shown event */
var nextEvent = null;

/**
 * Fetches an existing mei file from any url
 * @param {String} meiUrl 
 */
function fetchMEI(meiUrl) {
    if(meiUrl)
    {
        fetch(meiUrl)
        .then(function(response) {
            return response.text();
        })
        .then(function(text) {
            meiFile.text = text;
            loadData();
            checkIfAlreadyRun();
        });
    }
}

/**
 * Prints block data into a table and shows it within the blocks modal
 */
function getSectionBlocks() {
    if (meiFile.blocks.length > 0) {
        $("#blockCount").text(meiFile.blocks.length);
        $("#blockTableBody").empty();
        for(let i = 0; i &lt; meiFile.blocks.length; i++) {
            let blockRow = $("&lt;tr>&lt;/tr>");
            blockRow.append(`&lt;td>${i}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].part}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].mens ? makeXmlCode(meiFile.blocks[i].mens.outerHTML) : ''}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].prop ? makeXmlCode(meiFile.blocks[i].prop.outerHTML) : ''}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].prevPropMultiplier ? meiFile.blocks[i].prevPropMultiplier : ''}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].events.length}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].dur}&lt;/td>`);
            blockRow.append(`&lt;td>${meiFile.blocks[i].totaldur}&lt;/td>`);
            $("#blockTableBody").append(blockRow);
        }

        $("#blocksInfo").modal('show');
    }
}

/**
 * Loads meiFile with Verovio and adds MEI blob to download button
 */
function loadData() {
    updateBlob();
    vrvInterface.loadData(meiFile.text);
}

/**
 * Updates the MEI blob and serve it
 */
function updateBlob() {
    meiFile.renewBlob();
    $("#download").attr("href", URL.createObjectURL(meiFile.blob));
}

/**
 * Wraps an xml string into \&lt;code\> elements to display code highlighting
 * @param {String} htmlString 
 * @returns {String}
 */
function makeXmlCode(htmlString) {
    let ltString = htmlString.replace(/&lt;/gm,"&amp;lt;");
    let gtString = ltString.replace(/>/gm, "&amp;gt;");

    return `&lt;code>${gtString}&lt;/code>`
}


/**
 * Shows event details of chosen element
 * @param {DOMObject} eventEl 
 */
    function showDetails(eventEl) {
    const formAttrs = ["dur.quality", "rule", "dur.metrical", "num", "numbase"];
    const additionalAttrs = ["defaultminims", "comment"];
    const positionAttrs = ["startsAt", "mensurBlockStartsAt", "beatPos", "onTheBreveBeat", "crossedABreveBeat"];

    const dtTag = "&lt;dt class='col-4 text-truncate dyAttTerm' data-toggle='tooltip'>&lt;/dt>";
    const ddTag = "&lt;dd class='col-8 dyAttValue'>&lt;/dd>";

    hideDetails();
    $(eventEl).addClass("selected");

    var thisID = $(eventEl).attr("id");
    var attributes;
    if(thisID) attributes = ioHandler.getPropertyByID(thisID, null, 0);
    if (attributes)
    {
        $("#additional").prop("hidden", true);
        for (let attr in attributes)
        {
            // retrieve Values for interpreter modification form
            if(formAttrs.indexOf(attr)!=-1)
            {
                //let attrMod = attr.replace(".","");
                let formID = "#" + attr.replace(".","") + "Interpreter";
                let formInputID = "#" + attr.replace(".","") + "User";
                /*if(typeof attributes[attr]==="string")
                {
                    $(formID).attr("placeholder",attributes[attr]);
                    $(formID).attr("title",attributes[attr]);
                }
                else
                {*/
                    $(formInputID).val(attributes[attr].user);
                    $(formID).attr("placeholder",attributes[attr].interpreter);
                    $(formID).attr("title",attributes[attr].inter);
                //}                
            }
            // beatPos is a readonly Extrawurst
            else if (attr==="beatPos")
            {
                var beatPosArray;
                var beatPosCorrArray;

                if(attributes[attr].sic === null)
                {
                    beatPosArray = attributes[attr].corr.split(", ");
                }
                else
                {
                    beatPosArray = attributes[attr].sic.split(", ");
                    beatPosCorrArray = attributes[attr].corr.split(", ");
                }

                for(let i = 0; i &lt; beatPosArray.length; i++)
                {
                    let cellID = "#beatPos" + i;
                    $(cellID).text(beatPosArray[i]);

                    if(beatPosCorrArray!=null)
                    {
                        $(cellID).contents().wrap("&lt;s>&lt;/s>");
                        let corrID = "#beatPosCorr" + i;
                        $(corrID).append($("&lt;strong>&lt;/strong>").text(beatPosCorrArray[i]));
    
                    }
                }
                
            }
            // all other readonly attributes
            else
            {
                let dt = $(dtTag).text(attr);
                $(dt).attr("title",attr);
                let dd = $(ddTag);

                if (typeof attributes[attr] === "string")
                {
                    dd.text(attributes[attr]);
                }
                else if(attributes[attr].sic === null)
                {
                    dd.text(attributes[attr].corr);
                }
                else
                {
                    let sic = $("&lt;s>&lt;/s>").text(attributes[attr].sic);
                    let corr = $("&lt;strong>&lt;/strong>").text(attributes[attr].corr);

                    dd.append(sic);
                    dd.append(corr);
                }

                if(positionAttrs.indexOf(attr)!=-1)
                {
                    $("#posAttList").append(dt);
                    $("#posAttList").append(dd);
                }
                else if(attr!=="xml:id" &amp;&amp; attr!=="type" &amp;&amp; additionalAttrs.indexOf(attr)==-1)
                {
                    $("#attList").append(dt);
                    $("#attList").append(dd);
                }
                else if(additionalAttrs.indexOf(attr)!==-1)
                {
                    $("#addAttList").append(dt);
                    $("#addAttList").append(dd);
                    $("#additional").prop("hidden", false);
                }
            }
        }
        
        shownEvent = eventEl;
        nextEvent = $(eventEl).next();
        prevEvent = $(eventEl).prev();

        $("#basic").prop("hidden", false);
        if(basicAnalysisDone || instructor) $("#interpreterResult").prop("hidden", false);
        if(basicAnalysisDone) $("#positions").prop("hidden", false);
        if(instructor &amp;&amp; basicAnalysisDone) $("#submitFeedback").prop('disabled', true);
        $("#hideInfo").prop("disabled", false);
        $("#hideInfo").click(function() {
            hideDetails();
        });
    }
}

/**
 * Remove details of the currently shown event
 */
function hideDetails() {
    //const killRed = "[fill='" + red + "']";
    $(".selected").removeClass("selected");
    shownEvent = null;
    nextEvent = null;
    prevEvent = null;
    $("#hideInfo").prop("disabled", true);
    $("#basic").prop("hidden", true);
    $("#interpreterResult").prop("hidden", true);
    $(".dyAttTerm, .dyAttValue").remove();
    $(".dyValueContainer").empty();
    $(".dyValuePlaceholder").attr("placeholder","");
    $(".interpreterInput").val("");
}

/**
 * Checks if the current file has already been modified by the interpreter
 */
function checkIfAlreadyRun() {
    var change = meiFile.doXPathOnDoc("//mei:change[@resp='" + intResp + "']", meiFile.doc, 3).booleanValue;
    if(change)
    {
        basicAnalysisDone = true;
        complexAnalysisDone = true;
        $("#beatIndependent").prop('disabled', true);
        $("#complexBeatAnalysis").prop('disabled', true);
    }
    else
    {
        basicAnalysisDone = false;
        complexAnalysisDone = false;
        $("#beatIndependent").prop('disabled', false);
        $("#complexBeatAnalysis").prop('disabled', false);
    }
}

/**
 * Evaluates the differences of user feed and interpreter and adds a type to events:
 * * correct: the user inserted a value that wasn't changed by the interpreter
 * * wrongRule: only rule has been changed by the interpreter
 * * wrong: Values other than rule differ or a modification has not been set by the user
 * Events without modification and no user feed at all stay black!
 */
function evaluateResults(){
    for (let [key, value] of Object.entries(meiFile.annotations))
    {
        let event = meiFile.eventDict[key];
        // check if there are choices
        if(meiFile.doXPathOnDoc("./mei:annot[mei:choice]", value, 3).booleanValue === false)
        {
            if(meiFile.doXPathOnDoc("count(./mei:annot/@resp[.!='" + intResp + "'])", value, 1).numberValue >= 1)
            {
                // a non-interpreter-resp within annot must be correct
                event.setAttribute("type", "correct");
            }
            else if(meiFile.doXPathOnDoc("./mei:annot[(@type='dur.quality' or @type='num' or @type='numbase') and @resp='" + intResp + "']", value, 3).booleanValue)
            {
                // a quality that has not been entered by the user is wrong
                event.setAttribute("type", "wrong");
            }
        }
        else
        {
            // collect all choices
            let choiceAnnots = meiFile.doXPathOnDoc("./mei:annot[mei:choice]/@type", value, 6);
            let choices = [];
            let userValues = ["dur.quality", "num", "numbase", "rule", "dur.metrical"];
        
            // build an array with annot types that contain choices
            for(let i=0; i &lt; choiceAnnots.snapshotLength; i++)
            {
                let propWithChoice = choiceAnnots.snapshotItem(i).value;
                if(userValues.indexOf(propWithChoice)>=0)
                {
                    choices.push(propWithChoice);
                }
            }
            // don't evaluate elements without any choices
            if(choices.length>0)
            {
                // As only cases with more than 0 choices are observed,
                // there is only one possibilty for a wrong rule
                // everything else at this point must be wrong
                if(choices.length===1 &amp;&amp; choices[0]==="rule")
                {
                    event.setAttribute("type", "wrongRule");
                }
                else
                {
                    event.setAttribute("type", "wrong");
                }
            }
        }
    }
}

$(document).ready(function(){

    var meiUrl = currentParams.get("url");
    
    // toggle instructor mode by url param
    instructor = currentParams.get("mode")==="instructor" ? true : false;

    if(meiUrl) 
    {
        fetchMEI(meiUrl);
    }
    
    // fancy file input animation
    bsCustomFileInput.init()   

    $("#customFile").change(function() {
        let meiBlob = this.files[0];

        var reader = new FileReader();
        reader.readAsText(meiBlob);

        reader.onload = function(event) {
            meiFile.text = event.target.result;
            currentParams.set("url", null);
            window.history.pushState({}, "Mensural interpreter", `${baseUrl}`);
            loadData();
            checkIfAlreadyRun();
        };    
    });

    $("#btnResetFile").click(function() {
        $("#fileInput")[0].reset();
        $("#elementInfo").empty();
    });
    
    $("#load").click(function() {
        let input = $("#url").val();
        currentParams.set("url", input);
        location.replace(`${baseUrl}?${currentParams}`);
        $("#elementInfo").empty();
        return false;
    });

    $("#blockify").click(function() {
        getSectionBlocks();
    });

    $("#beatIndependent").click(function() {
        if (basicAnalysisDone===false)
        {
            basic.beatIndependentDurations(meiFile);
            startTimes.addStartTimes(meiFile);
            basicAnalysisDone = true;
            $("#beatIndependent").prop('disabled', true);
            loadData();
        }
    });

    $("#complexBeatAnalysis").click(function() {
        if(basicAnalysisDone===false)
        {
            basic.beatIndependentDurations(meiFile);
            startTimes.addStartTimes(meiFile);
            basicAnalysisDone = true;
            $("#beatIndependent").prop('disabled', true);
        }

        if(basicAnalysisDone===true &amp;&amp; complexAnalysisDone===false)
        {
            complexBeats.complexAnalysis(meiFile);
            post.run(meiFile);
            if(instructor===true)
            {
                evaluateResults();
            }
            loadData();
            complexAnalysisDone = true;
            $("#complexBeatAnalysis").prop('disabled', true);
        }
    });

    $("#vrvForw").click(function() {
        vrvInterface.nextPage();
    });
    $("#vrvBack").click(function() {
        vrvInterface.prevPage();
    });

    $("#vrvZoomIn").click(function() {
        vrvInterface.zoomIn();
    });

    $("#vrvZoomOut").click(function() {
        vrvInterface.zoomOut();
    });

    $("#submitFeedback").click(function() {
        let usrInput = {
            "dur.quality" : $("#durqualityUser").val(),
            "rule" : $("#ruleUser").val(),
            "num" : $("#numUser").val(),
            "numbase": $("#numbaseUser").val(),
            "dur.metrical" : $("#durmetricalUser").val(),
            "resp.name" : $("#userName").val(),
            "resp.initials" : $("#userInitials").val()
        };

        //make empty strings null
        for (let prop in usrInput)
        {
            if(usrInput[prop] === '') usrInput[prop] = null;
        }

        ioHandler.submitFeedback(usrInput, $(shownEvent).attr("id"));
        
        // calculate corrected startTimes (not useful in instructor mode)
        if(instructor===false)
        {
            startTimes.addStartTimes(meiFile);
        }

        //updateBlob();
        loadData();
        
    });

    $(window).resize(function(){
        vrvInterface.applyZoom();
    });

});
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Oct 07 2021 15:33:41 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
